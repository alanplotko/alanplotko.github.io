{% if site.staticman.endpoint %}
<div class="staticman-comments">
    <div class="page__comments">
        <!-- Start static comments -->
        <div class="js-comments">
        {% if site.data.comments[page.slug] %}
            <h2 class="page__comments-title">Comments</h2>
            {% assign comments = site.data.comments[page.slug] %}
            {% for comment in comments %}
            {% assign email = comment.email %}
            {% assign name = comment.name %}
            {% assign date = comment.date %}
            {% assign message = comment.message %}
            {% include comment.html index=forloop.index email=email name=name date=date message=message %}
            {% endfor %}
        {% endif %}
        </div>
        <!-- End static comments -->
    </div>
</div>

<div class="pt-3"></div>

{% unless page.comments_locked == true %}
<!-- Start new comment form -->
<div id="respond">
    <h2 class="page__section-label">Leave a Comment <small><a rel="nofollow" id="cancel-comment-reply-link"
                href="{{ page.url | absolute_url }}#respond" style="display:none;">Cancel reply</a></small></h2>
    <p class="instruct"><a href="https://daringfireball.net/projects/markdown/syntax">Markdown</a> is allowed. Email
        addresses will not be published.</p>
    <form id="comment-form" class="row g-3 page__form js-form form" method="post" action="{{ site.staticman.endpoint}}">
        <div class="col-12">
            <label for="comment-form-email" class="form-label">Email Address <small>(used for <a href="https://en.gravatar.com/">Gravatar</a> image and reply notifications)</small></label>
            <input type="email" class="form-control" id="comment-form-email" name="fields[email]" spellcheck="false" required="true">
        </div>
        <div class="col-12">
            <label for="comment-form-name" class="form-label">Name</label>
            <input type="text" class="form-control" id="comment-form-name" name="fields[name]" spellcheck="false" required="true">
        </div>
        <div class="col-12">
            <label for="comment-form-message">Comment</label>
            <textarea class="form-control" placeholder="Leave a comment here" id="comment-form-message" rows="3" name="fields[message]" spellcheck="true" required="true"></textarea>
        </div>
        <div class="input-group mb-3 d-none">
            <input type="hidden" name="options[origin]" value="{{ page.url | absolute_url }}">
            <input type="hidden" id="comment-parent" name="options[parent]" value="">
            <input type="hidden" id="comment-post-id" name="options[slug]" value="{{ page.slug }}">
            <label for="comment-form-location">Leave blank if you are a human</label>
            <input type="text" id="comment-form-location" name="fields[hidden]" autocomplete="off" />
            {% if site.staticman.reCaptcha.siteKey %}<input type="hidden" name="options[reCaptcha][siteKey]" value="{{ site.staticman.reCaptcha.siteKey }}">{% endif %}
            {% if site.staticman.reCaptcha.secret %}<input type="hidden" name="options[reCaptcha][secret]" value="{{ site.staticman.reCaptcha.secret }}">{% endif %}
        </div>
        <!-- Start comment form alert messaging -->
        <p class="d-none js-notice alert">
            <strong class="js-notice-text-success d-none">{{ site.data.ui-text[site.locale].comment_success_msg | default: "Thanks for your comment! It will show on the site once it has been approved." }}</strong>
            <strong class="js-notice-text-failure d-none">{{ site.data.ui-text[site.locale].comment_error_msg | default: "Sorry, there was an error with your submission. Please make sure all required fields have been completed and try again." }}</strong>
        </p>
        <!-- End comment form alert messaging -->
        {% if site.staticman.reCaptcha.siteKey %}
            <div class="form-group">
            <div class="g-recaptcha" data-sitekey="{{ site.staticman.reCaptcha.siteKey }}"></div>
            </div>
        {% endif %}
        <div class="form-group">
            <button type="submit" id="comment-form-submit" tabindex="5" class="btn btn-primary btn">Submit Comment</button>
            <button type="submit" id="comment-form-submitted" tabindex="5" class="btn btn-primary btn d-none" disabled>Submitted</button>
        </div>
    </form>
</div>
<!-- End new comment form -->
<!-- Load reCaptcha if site key is set -->
{% if site.staticman.reCaptcha.siteKey %}
    <script async src="https://www.google.com/recaptcha/api.js"></script>
{% endif %}

{% else %}
    <p class="lead"><em>Comments are closed for this post.</em></p>
{% endunless %}
{% endif %}
